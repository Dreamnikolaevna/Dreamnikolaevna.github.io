<!DOCTYPE html>

<html>

<head>
  <meta charset="utf-8">
  <link href="style.css" rel="stylesheet">
  <title>ИУ4-12Б супер крутой сайт 2000</title>
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <script>
    $(() => {
      $("#header").load("header.html");
      $.post("fetch_comment.php", {},
        (data) => {
          let comments = $.parseJSON(data);
          $.each(comments, (i, item) => {
            let $tr = $('<tr>').append(
                $('<td>').text(item[1] + ':'),
                $('<td>').text(item[2])
              ).appendTo('#comments-table');
          })
        })
      });

    function sendComment() {
      let text = $("#comment-text").val();
      if (text == "") alert("Пустой комментарий!");
      else {
        $("#comment-button").val("Отправка...");
        $("#comment-button").prop('disabled', true);
        $.post("send_comment.php", {text: text},
          (data) => {
            $("#comment-result").html(data);
            $("#comment-button").val("Отправить");
            $("#comment-button").prop('disabled', false);
          });
      }
    }
  </script>
</head>

<body>
  <header id="header"></header>
  <div class="comments"><table id="comments-table"></table></div>
  <div class="not-logined">
    <p> Комментирование доступно только зарегестрированным пользователям </p>
  </div>
  <div class="add-comment logined">
    <form onsubmit="formSumbit(false)" method="post">
      <textarea id="comment-text" rows="8" cols="80" placeholder="Комментарий" required></textarea>
      <input id="comment-button" type="button" onclick="sendComment()" value="Отправить">
    </form>
    <div id="comment-result"></div>
  </div>
</body>

</html>
